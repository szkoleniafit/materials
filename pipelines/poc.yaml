name: $(Date:yyyyMMdd).$(Rev:r).$(Build.BuildId)

stages:
  - stage: Stage
    jobs:
      - job: Build
        steps:
        - bash: echo "##vso[task.setvariable variable=myStageOutputVar;isOutput=true]$myVar"
          env:
            myVar: 'this is a stage output var'
          name: printvar

  - stage: Swap
    dependsOn: Stage
    variables:
      myVarfromStage: $[ stageDependencies.Stage.outputs['printvar.myStageOutputVar'] ]
    jobs:
      - job: Build
        steps:
          - script: echo "Here $(myVarfromStage)"

#stages:
#  - stage: PreBuild
#    displayName: Pre build stage
#    jobs:
#    - job: Build
#      steps:
#        - template: ../templates/echo_list.yml
#
#  - stage: Build
#    displayName: Build stage
#    dependsOn: PreBuild
#    variables:
#      list: $[ stageDependencies.PreBuild.echo.outputs['PreBuild.echo.MODULES_IMPACTED'] ]
#    jobs:
#      - template: ../templates/job1.yaml
#        parameters:
#          jobs: ${{ variables.list }}